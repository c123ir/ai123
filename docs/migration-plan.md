# برنامه مهاجرت به ساختار جدید (نسخه ۲)

## چشم‌انداز کلی
این سند برنامه مهاجرت تدریجی از ساختار فعلی به ساختار جدید مبتنی بر ماژول را تشریح می‌کند. هدف این مهاجرت، بهبود سازماندهی کد، کاهش وابستگی‌های متقابل و افزایش قابلیت نگهداری پروژه است.

## مراحل مهاجرت

### مرحله ۱: آماده‌سازی و پشتیبان‌گیری
- [x] تهیه پشتیبان از کد فعلی
- [x] ایجاد شاخه جدید برای توسعه ساختار جدید
- [x] تهیه مستندات ساختار جدید

### مرحله ۲: ایجاد ساختار پوشه‌ای جدید
- [x] ایجاد ساختار پوشه‌بندی اصلی (`modules`, `shared`, `admin`, `user`)
- [x] انتقال `ThemeContext` به مسیر جدید در `modules/shared/context`
- [x] انتقال توابع کمکی به `modules/shared/utils`
- [x] اصلاح مشکل `BrowserRouter` موازی در `App.tsx` و `index.tsx`

### مرحله ۳: مهاجرت کامپوننت‌ها و صفحات (در حال انجام)
- [ ] انتقال کامپوننت‌های `common` به `modules/shared/components/common`
- [ ] اصلاح مسیرهای ایمپورت در فایل‌های منتقل شده
- [ ] انتقال صفحات بخش مدیریت به `modules/admin/pages`
- [ ] انتقال صفحات بخش کاربری به `modules/user/pages`

### مرحله ۴: پاکسازی و یکپارچه‌سازی
- [ ] حذف کامپوننت‌های تکراری و منسوخ
- [ ] یکپارچه‌سازی سرویس‌ها و API‌ها
- [ ] به‌روزرسانی مسیرهای ایمپورت در همه‌جا
- [ ] اصلاح خطاهای تایپی و سازگاری TypeScript

### مرحله ۵: بهینه‌سازی و تست
- [ ] اجرای تست‌ها برای اطمینان از عملکرد صحیح
- [ ] رفع خطاهای احتمالی
- [ ] بهینه‌سازی بارگذاری با تکنیک‌های Lazy Loading
- [ ] بازبینی نهایی کد و مستندات

## جدول زمانی

| مرحله | زمان تخمینی | وضعیت |
|-------|-------------|--------|
| مرحله ۱ | ۱ روز | ✅ تکمیل شده |
| مرحله ۲ | ۳ روز | ✅ تکمیل شده |
| مرحله ۳ | ۵ روز | ⏳ در حال انجام |
| مرحله ۴ | ۵ روز | ⏳ آینده |
| مرحله ۵ | ۲ روز | ⏳ آینده |

## راهنمای مهاجرت برای توسعه‌دهندگان

### الگوهای مهاجرت کامپوننت‌ها

**۱. انتقال کامپوننت:**
1. ایجاد فایل جدید در مسیر جدید
2. کپی کد از فایل قدیمی
3. اصلاح مسیرهای ایمپورت
4. به‌روزرسانی اکسپورت‌ها

**مثال انتقال:**
```bash
# ایجاد دایرکتوری مقصد
mkdir -p src/modules/shared/components/common/

# کپی فایل
cp src/components/common/Button.tsx src/modules/shared/components/common/
```

**۲. اصلاح مسیرهای ایمپورت:**
```tsx
// قبل از مهاجرت
import { Typography } from '../../components/common/Typography';

// بعد از مهاجرت
import { Typography } from '../../modules/shared/components/common/Typography';
```

**۳. به‌روزرسانی فایل‌های index:**
```tsx
// src/modules/shared/components/common/index.ts
export { default as Button } from './Button';
export { default as Card } from './Card';
// ... سایر اکسپورت‌ها
```

### چک‌لیست انتقال فایل‌ها

- [ ] کامپوننت‌های common
   - [ ] Button.tsx
   - [ ] Card.tsx
   - [ ] Input.tsx
   - [ ] Modal.tsx
   - [ ] Table.tsx
   - [ ] ...

- [ ] صفحات
   - [ ] صفحات مدیریت
   - [ ] صفحات کاربری
   - [ ] صفحات عمومی

- [ ] سرویس‌ها
   - [ ] AuthService
   - [ ] ApiService
   - [ ] ...

## آدرس‌دهی نسبی جدید

برای سهولت در آدرس‌دهی، پیشنهاد می‌شود از الگوهای زیر استفاده کنید:

- برای کامپوننت‌های مشترک: `@shared/components/common/[ComponentName]`
- برای کانتکست‌ها: `@shared/context/[ContextName]`
- برای توابع کمکی: `@shared/utils/[UtilName]`
- برای ماژول مدیریت: `@admin/pages/[PageName]`
- برای ماژول کاربری: `@user/pages/[PageName]`

## راهکارهای حل چالش‌های مهاجرت

### ۱. تداخل نام‌های کامپوننت
در صورت وجود کامپوننت‌های تکراری با نام‌های مشابه، از روش‌های زیر استفاده کنید:
- نام‌گذاری مجدد با پیشوند یا پسوند مناسب
- ادغام کامپوننت‌های مشابه
- استفاده از ورژن‌های مختلف با نام‌گذاری آشکار (مثلاً `ButtonV1`, `ButtonV2`)

### ۲. وابستگی‌های چرخشی
برای حل مشکل وابستگی‌های چرخشی:
- استخراج کد مشترک به یک ماژول مستقل
- استفاده از الگوی Mediator
- بازطراحی ساختار کامپوننت‌ها برای کاهش وابستگی‌ها

### ۳. سازگاری رو به عقب
برای حفظ سازگاری با کد قدیمی:
- ایجاد alias‌های موقت برای مسیرهای قدیمی
- استفاده از الگوی Adapter
- مستندسازی دقیق تغییرات API‌های عمومی

## مستندات و منابع کمکی

- [مستندات ساختار جدید](./v2-structure.md)
- [راهنمای رفع خطاها](./error-fixing-guide.md)
- [الگوهای طراحی توصیه شده](./design-patterns.md) 