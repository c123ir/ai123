# مستندات ساختار برنامه - نسخه ۲

## مقدمه
این مستند ساختار جدید برنامه را توضیح می‌دهد که برای سازمان‌دهی بهتر کد و رفع مشکلات قبلی طراحی شده است. در ساختار جدید، کامپوننت‌ها و منابع به صورت ماژولار سازماندهی شده‌اند تا نگهداری و توسعه کد آسان‌تر شود.

## اهداف بازسازماندهی
- بهبود سازماندهی کد
- جلوگیری از تکرار کد
- ایجاد یک ساختار مشخص و استاندارد برای توسعه
- تفکیک دقیق‌تر بخش‌های مختلف برنامه
- رفع خطاهای مربوط به مسیردهی نادرست

## ساختار پوشه‌بندی

```
src/
├── assets/              # فایل‌های استاتیک (تصاویر، فونت‌ها، استایل‌ها)
│   ├── fonts/           # فونت‌های استفاده شده در برنامه
│   ├── images/          # تصاویر مورد استفاده در برنامه
│   └── styles/          # استایل‌های سراسری
├── modules/             # ماژول‌های اصلی برنامه
│   ├── admin/           # ماژول مدیریت
│   │   ├── components/  # کامپوننت‌های مختص مدیریت
│   │   ├── pages/       # صفحات بخش مدیریت
│   │   └── services/    # سرویس‌های بخش مدیریت
│   ├── shared/          # ماژول اشتراکی (استفاده شده در کل برنامه)
│   │   ├── components/  # کامپوننت‌های مشترک
│   │   │   └── common/  # کامپوننت‌های پایه مشترک
│   │   ├── context/     # کانتکست‌های ری‌اکت (مثل ThemeContext)
│   │   ├── hooks/       # هوک‌های سفارشی
│   │   ├── types/       # تعاریف تایپ‌های مشترک
│   │   └── utils/       # توابع کمکی مشترک
│   └── user/            # ماژول کاربران
│       ├── components/  # کامپوننت‌های مختص کاربران
│       ├── pages/       # صفحات بخش کاربران
│       └── services/    # سرویس‌های بخش کاربران
├── pages/               # صفحات اصلی برنامه
│   ├── admin/           # صفحات مدیریتی
│   ├── simple/          # صفحات ساده سایت
│   └── user/            # صفحات کاربری
├── routes/              # تعریف مسیرهای برنامه
│   ├── AdminRoutes.tsx  # مسیرهای بخش مدیریت
│   ├── SimpleRoutes.tsx # مسیرهای سایت ساده
│   └── UserRoutes.tsx   # مسیرهای بخش کاربری
├── layout/              # لایه‌های اصلی برنامه
├── services/            # سرویس‌های اصلی برنامه (API، احراز هویت و...)
├── store/               # مدیریت state با Redux
├── theme/               # تنظیمات تم برنامه (روشن/تاریک)
├── App.tsx              # کامپوننت اصلی برنامه
└── index.tsx            # نقطه ورود برنامه
```

## تغییرات ایجاد شده

### ۱. انتقال کامپوننت‌های common به ماژول shared

کامپوننت‌های مشترک از `src/components/common` به مسیر جدید `src/modules/shared/components/common` منتقل شده‌اند. این تغییر باعث می‌شود تمام کامپوننت‌های مشترک در یک مسیر مشخص قرار گیرند.

### ۲. ایجاد ماژول context در shared

کانتکست‌های ری‌اکت مانند `ThemeContext` در مسیر `src/modules/shared/context` قرار گرفته‌اند. این باعث می‌شود دسترسی به کانتکست‌ها از تمام بخش‌های برنامه آسان باشد.

### ۳. ایجاد بخش utils در shared

توابع کمکی مانند `DigitConverter` در مسیر `src/modules/shared/utils` قرار گرفته‌اند. این توابع می‌توانند در کل برنامه استفاده شوند.

### ۴. جداسازی تنظیمات تم

تنظیمات مربوط به تم در پوشه `src/theme` قرار گرفته‌اند تا مدیریت تم‌های مختلف (روشن و تاریک) آسان‌تر شود.

### ۵. رفع مشکل دو `BrowserRouter` موازی

در نسخه قبلی، هم در `index.tsx` و هم در `App.tsx` از `BrowserRouter` استفاده شده بود که باعث خطا می‌شد. در نسخه جدید، فقط یک `BrowserRouter` در `index.tsx` وجود دارد.

## روش‌های دسترسی جدید

### دسترسی به ThemeContext

```typescript
// روش قبلی:
import { useTheme } from '../../../components/common/ThemeContext';

// روش جدید:
import { useTheme, useThemeContext } from '../../../modules/shared/context/ThemeContext';
```

### دسترسی به DigitConverter

```typescript
// روش قبلی:
import DigitConverter from '../../../components/common/DigitConverter';

// روش جدید:
import DigitConverter from '../../../modules/shared/utils/DigitConverter';
```

## مزایای ساختار جدید

1. **سازماندهی بهتر کد**: کامپوننت‌ها به صورت منطقی گروه‌بندی شده‌اند.
2. **مقیاس‌پذیری**: افزودن ماژول‌های جدید آسان‌تر شده است.
3. **کاهش وابستگی‌های متقابل**: ماژول‌ها می‌توانند به صورت مستقل توسعه یابند.
4. **خوانایی بهتر کد**: مسیرهای ایمپورت معنادارتر و قابل فهم‌تر شده‌اند.
5. **بهبود مدیریت state**: کانتکست‌ها و state در مکان‌های مشخص تعریف شده‌اند.

## مهم: تغییرات آینده
برای بهبود بیشتر ساختار برنامه و رفع خطاهای باقی‌مانده، تغییرات زیر پیشنهاد می‌شود:

1. **یکپارچه‌سازی فایل‌های تکراری**: بررسی و حذف نسخه‌های تکراری از کامپوننت‌ها
2. **به‌روزرسانی مسیرهای ایمپورت**: اطمینان از اینکه تمام فایل‌ها به مسیرهای جدید اشاره می‌کنند
3. **استفاده از alias در مسیردهی**: تنظیم alias برای مسیرهای متداول (مثلاً `@shared/*` برای دسترسی به ماژول shared)
4. **پیاده‌سازی کامل Lazy Loading**: بارگذاری تنبل برای بهبود عملکرد
5. **بهبود مدیریت خطا**: ایجاد یک سیستم یکپارچه برای مدیریت و نمایش خطاها

## رفع خطاهای عمده

1. **خطای Router**: خطای مربوط به تداخل دو `BrowserRouter` با حذف `BrowserRouter` اضافی از `App.tsx` رفع شد.
2. **خطای مسیردهی ThemeContext**: مسیرهای مربوط به کانتکست تم به‌روزرسانی شدند.
3. **خطای import تم**: مسیر ایمپورت فایل‌های تم در `ThemeContext.tsx` اصلاح شد.

## راهنمای استفاده برای توسعه‌دهندگان

1. **افزودن کامپوننت جدید**: کامپوننت‌های جدید را بر اساس کاربرد در ماژول مربوطه قرار دهید. اگر کامپوننت در کل برنامه استفاده می‌شود، آن را در `modules/shared/components` قرار دهید.
2. **افزودن صفحه جدید**: صفحات جدید را در پوشه `pages` یا زیرپوشه‌های آن قرار دهید و سپس در فایل `routes` مربوطه ثبت کنید.
3. **ایجاد سرویس جدید**: سرویس‌های جدید را در `services` یا در ماژول مربوطه قرار دهید.
4. **به‌روزرسانی تم**: برای تغییر تم، فایل‌های مربوطه در پوشه `theme` را ویرایش کنید. 