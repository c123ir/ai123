# سیستم توکن مانیبل (MoneyBell)
<div dir="rtl">
## مقدمه

این سند، ساختار، قواعد و نحوه پیاده‌سازی سیستم توکن مانیبل (MoneyBell) در پروژه دستیار هوشمند یک دو سه (SmartAi123) را تشریح می‌کند. سیستم توکن مانیبل، یکی از ویژگی‌های اصلی و متمایزکننده این پروژه است که به کاربران امکان می‌دهد با انجام فعالیت‌های مختلف، توکن کسب کرده و از آن‌ها برای دریافت خدمات و مزایای مختلف استفاده کنند.

## مفهوم توکن مانیبل (MoneyBell)

### تعریف

مانیبل (MoneyBell) یک واحد ارزش دیجیتال است که به معنای "زنگ پول" می‌باشد. این توکن به عنوان واحد پاداش و ارزش درون پلتفرم عمل می‌کند که کاربران می‌توانند آن را از طریق انجام فعالیت‌های مختلف کسب کرده و برای دریافت خدمات و مزایا استفاده کنند.

### انواع توکن

1. **توکن پاداشی (Reward)**
   - دارای تاریخ انقضا (معمولاً 6 ماه)
   - از طریق فعالیت‌های مشخص در پلتفرم کسب می‌شود
   - غیرقابل انتقال به کاربران دیگر

2. **توکن خریداری شده (Purchased)**
   - بدون تاریخ انقضا
   - از طریق خرید مستقیم به دست می‌آید
   - قابل انتقال به کاربران دیگر (با محدودیت)

3. **توکن وفاداری (Loyalty)**
   - دارای تاریخ انقضا (معمولاً 12 ماه)
   - بر اساس سطح وفاداری کاربر به صورت دوره‌ای اعطا می‌شود
   - غیرقابل انتقال به کاربران دیگر

## اکوسیستم مانیبل

### 1. کسب (Earning)

کاربران می‌توانند از طریق روش‌های زیر توکن مانیبل کسب کنند:

#### الف. فعالیت‌های پاداشی

| فعالیت | مقدار توکن | نوع توکن | توضیحات |
|--------|------------|-----------|----------|
| ثبت‌نام | 10 | پاداشی | یکبار پس از تأیید ثبت‌نام |
| تکمیل پروفایل | 20 | پاداشی | یکبار پس از تکمیل تمام فیلدهای پروفایل |
| دعوت دوستان | 50 | پاداشی | به ازای هر دوست که ثبت‌نام کند |
| خرید | 1 | پاداشی | به ازای هر 100,000 تومان خرید |
| پرداخت اقساط | 5 | پاداشی | به ازای هر قسط پرداختی به‌موقع |
| شرکت در نظرسنجی | 15 | پاداشی | به ازای هر نظرسنجی تکمیل شده |
| نوشتن نقد و بررسی | 25 | پاداشی | به ازای هر نقد تأیید شده |

#### ب. سرمایه‌گذاری (تولید مستمر)

| میزان سرمایه‌گذاری (تومان) | تولید ماهانه توکن | نوع توکن |
|---------------------------|-------------------|-----------|
| 10,000,000 - 50,000,000 | 10 | وفاداری |
| 50,000,001 - 100,000,000 | 25 | وفاداری |
| 100,000,001 - 500,000,000 | 50 | وفاداری |
| بیش از 500,000,000 | 100 | وفاداری |

#### ج. خرید مستقیم

| مبلغ پرداختی (تومان) | تعداد توکن | نوع توکن |
|---------------------|-----------|-----------|
| 100,000 | 50 | خریداری شده |
| 250,000 | 125 | خریداری شده |
| 500,000 | 300 | خریداری شده |
| 1,000,000 | 700 | خریداری شده |

### 2. مصرف (Spending)

کاربران می‌توانند توکن‌های خود را به روش‌های زیر استفاده کنند:

#### الف. تخفیف در خرید

| تعداد توکن | میزان تخفیف | حداکثر مبلغ تخفیف (تومان) |
|------------|------------|--------------------------|
| 100 | 5% | 500,000 |
| 200 | 10% | 1,000,000 |
| 300 | 15% | 1,500,000 |
| 500 | 20% | 2,000,000 |

#### ب. ارتقای خدمات

| تعداد توکن | خدمات قابل دریافت |
|------------|-------------------|
| 200 | تمدید گارانتی (3 ماه اضافی) |
| 300 | ارسال سریع (ارسال در همان روز) |
| 400 | پشتیبانی ویژه (دسترسی به کارشناس اختصاصی) |
| 500 | خدمات نصب رایگان |

#### ج. افزایش نرخ سود سرمایه‌گذاری

| تعداد توکن | افزایش نرخ سود | مدت افزایش |
|------------|---------------|------------|
| 500 | 0.5% | 3 ماه |
| 1000 | 1% | 3 ماه |
| 1500 | 1.5% | 3 ماه |
| 2000 | 2% | 3 ماه |

#### د. تبدیل به هدیه و جایزه

| تعداد توکن | جایزه قابل دریافت |
|------------|-------------------|
| 300 | کارت هدیه 200,000 تومانی |
| 500 | لوازم جانبی (هدفون، ماوس، کیبورد) |
| 1000 | تبلت یا گوشی هوشمند رده متوسط |
| 2000 | لپ‌تاپ یا کامپیوتر رده متوسط |

### 3. اولویت مصرف توکن‌ها

هنگام مصرف توکن، سیستم از استراتژی زیر برای انتخاب توکن‌ها استفاده می‌کند:

1. ابتدا توکن‌های پاداشی نزدیک به انقضا
2. سپس توکن‌های وفاداری نزدیک به انقضا
3. توکن‌های پاداشی با تاریخ انقضای دورتر
4. توکن‌های وفاداری با تاریخ انقضای دورتر
5. در نهایت، توکن‌های خریداری شده

## معماری سیستم توکن

### 1. مدل‌های داده

#### جدول توکن‌ها (tokens)

```sql
CREATE TABLE tokens (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    amount INTEGER NOT NULL,
    type VARCHAR(50) NOT NULL, -- 'reward', 'purchased', 'loyalty'
    status VARCHAR(20) NOT NULL DEFAULT 'active', -- 'active', 'used', 'expired'
    source VARCHAR(50), -- 'purchase', 'activity', 'investment', 'referral'
    source_id UUID,
    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    expired_at TIMESTAMP WITH TIME ZONE
);
```

#### جدول تراکنش‌های توکن (token_transactions)

```sql
CREATE TABLE token_transactions (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    token_id UUID REFERENCES tokens(id) ON DELETE SET NULL,
    type VARCHAR(50) NOT NULL, -- 'earn', 'spend', 'expire', 'transfer'
    amount INTEGER NOT NULL,
    status VARCHAR(20) NOT NULL DEFAULT 'completed',
    description TEXT,
    related_entity_type VARCHAR(50), -- 'purchase', 'service', 'investment'
    related_entity_id UUID,
    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    metadata JSONB
);
```

#### جدول قوانین توکن (token_rules)

```sql
CREATE TABLE token_rules (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    rule_type VARCHAR(50) NOT NULL, -- 'earn', 'spend'
    activity_type VARCHAR(50) NOT NULL, -- 'signup', 'purchase', 'investment'
    token_type VARCHAR(50) NOT NULL, -- 'reward', 'purchased', 'loyalty'
    amount INTEGER NOT NULL,
    conditions JSONB,
    is_active BOOLEAN NOT NULL DEFAULT TRUE,
    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW()
);
```

#### جدول سطوح وفاداری (loyalty_levels)

```sql
CREATE TABLE loyalty_levels (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    name VARCHAR(100) NOT NULL,
    min_points INTEGER NOT NULL,
    max_points INTEGER,
    benefits JSONB NOT NULL,
    icon_url TEXT,
    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW()
);
```

### 2. معماری سرویس‌ها

```
+----------------------------------+
|           API Layer              |
|  +-----------------------------+ |
|  |     Token Controller        | |
|  +-----------------------------+ |
+----------------------------------+
               |
               v
+----------------------------------+
|         Service Layer            |
|  +-----------------------------+ |
|  |      Token Service          | |
|  +-----------------------------+ |
|  |    Transaction Service      | |
|  +-----------------------------+ |
|  |     Rule Service            | |
|  +-----------------------------+ |
+----------------------------------+
               |
               v
+----------------------------------+
|        Repository Layer          |
|  +-----------------------------+ |
|  |     Token Repository        | |
|  +-----------------------------+ |
|  |  Transaction Repository     | |
|  +-----------------------------+ |
|  |     Rule Repository         | |
|  +-----------------------------+ |
+----------------------------------+
               |
               v
+----------------------------------+
|         Database Layer           |
|  +-----------------------------+ |
|  |       PostgreSQL            | |
|  +-----------------------------+ |
|  |         Redis               | |
|  +-----------------------------+ |
+----------------------------------+
```

## پیاده‌سازی سیستم توکن

### 1. مدل‌ها و انواع داده

سیستم توکن از چندین نوع داده مهم استفاده می‌کند، از جمله:

- **TokenType**: انواع توکن (پاداشی، خریداری شده، وفاداری)
- **TokenStatus**: وضعیت‌های توکن (فعال، استفاده شده، منقضی شده، در انتظار)
- **TokenSource**: منابع توکن (خرید، فعالیت، سرمایه‌گذاری، ارجاع، ثبت‌نام)
- **TokenTransactionType**: انواع تراکنش (کسب، مصرف، انقضا، انتقال)
- **TransactionStatus**: وضعیت‌های تراکنش (کامل شده، در انتظار، ناموفق، لغو شده)

همچنین ساختارهای داده اصلی شامل:

- **Token**: مدل اصلی توکن با اطلاعاتی مانند کاربر، مقدار، نوع و تاریخ انقضا
- **TokenTransaction**: سابقه تراکنش‌های توکن
- **TokenRule**: قوانین تولید و مصرف توکن

### 2. ریپوزیتوری‌ها

ریپوزیتوری‌های سیستم توکن مسئول تعامل با پایگاه داده هستند:

- **TokenRepository**: مدیریت توکن‌ها شامل ایجاد، به‌روزرسانی و جستجو
- **TokenTransactionRepository**: مدیریت تراکنش‌های توکن
- **TokenRuleRepository**: مدیریت قوانین توکن

این ریپوزیتوری‌ها عملیات اصلی مانند ایجاد توکن جدید، دریافت توکن‌های کاربر، به‌روزرسانی وضعیت توکن، دریافت موجودی توکن و منقضی کردن توکن‌های قدیمی را انجام می‌دهند.

### 3. سرویس‌های سیستم توکن

سیستم توکن شامل چندین سرویس اصلی است که عملیات مختلف مربوط به توکن‌ها را مدیریت می‌کنند:

**سرویس توکن (Token Service)**
- مسئول ایجاد، به‌روزرسانی و دریافت توکن‌ها
- مدیریت مصرف توکن‌ها با رعایت اولویت مصرف
- بررسی موجودی و اعتبار توکن‌ها
- منقضی کردن توکن‌های قدیمی

**سرویس تراکنش (Transaction Service)**
- ثبت تمام فعالیت‌های مربوط به توکن‌ها
- نگهداری تاریخچه تراکنش‌های توکن
- تهیه گزارش‌های مختلف از تراکنش‌ها

**سرویس قوانین (Rule Service)**
- مدیریت قوانین تولید و مصرف توکن
- ارزیابی شرایط و محاسبه مقدار توکن
- به‌روزرسانی و تغییر قوانین در زمان اجرا

### 4. الگوریتم تولید و مصرف توکن

**الگوریتم تولید توکن:**
1. شناسایی رویداد تولیدکننده توکن (خرید، ثبت‌نام، سرمایه‌گذاری و غیره)
2. استخراج قانون مربوط به رویداد از جدول قوانین
3. محاسبه مقدار توکن بر اساس قانون
4. تعیین نوع توکن و تاریخ انقضا
5. ایجاد رکورد توکن و تراکنش در پایگاه داده
6. ارسال اعلان به کاربر

**الگوریتم مصرف توکن:**
1. دریافت درخواست مصرف توکن
2. بررسی موجودی کافی توکن‌های کاربر
3. دریافت لیست توکن‌های فعال کاربر
4. مرتب‌سازی توکن‌ها بر اساس اولویت مصرف
5. مصرف توکن‌ها به ترتیب (ابتدا توکن‌های نزدیک به انقضا)
6. ثبت تراکنش‌های مصرف
7. به‌روزرسانی وضعیت توکن‌های مصرف شده
8. ارائه مزایا یا خدمات مربوط به مصرف توکن

### 5. نگهداری و مدیریت توکن‌ها

**فرآیند انقضای خودکار توکن‌ها:**
- اجرای وظیفه زمان‌بندی شده (cron job) برای بررسی توکن‌های منقضی شده
- به‌روزرسانی وضعیت توکن‌های منقضی شده به `EXPIRED`
- ثبت تراکنش انقضا برای توکن‌های منقضی شده
- ارسال اعلان به کاربران درباره توکن‌های منقضی شده

**مدیریت تغییرات در قوانین توکن:**
- امکان فعال/غیرفعال کردن قوانین
- تغییر مقادیر و شرایط قوانین در زمان اجرا
- اعمال قوانین جدید بدون نیاز به تغییر کد
- نگهداری تاریخچه تغییرات قوانین

## رابط کاربری سیستم توکن

### 1. داشبورد توکن

داشبورد توکن، صفحه اصلی مدیریت توکن‌های کاربر است که شامل بخش‌های زیر است:

**نمای کلی توکن‌ها:**
- نمایش موجودی فعلی توکن‌ها
- نمودار توزیع توکن‌ها بر اساس نوع (پاداشی، خریداری شده، وفاداری)
- هشدار برای توکن‌های نزدیک به انقضا

**تاریخچه تراکنش‌ها:**
- لیست تراکنش‌های اخیر (کسب و مصرف)
- فیلتر بر اساس نوع تراکنش و بازه زمانی
- جزئیات هر تراکنش با امکان ردیابی منبع

**فرصت‌های کسب توکن:**
- نمایش فعالیت‌های فعلی برای کسب توکن
- پیشنهادهای شخصی‌سازی شده بر اساس رفتار کاربر
- دکمه‌های CTA برای هدایت کاربر به صفحات مربوطه

**فرصت‌های مصرف توکن:**
- نمایش خدمات و مزایای قابل دریافت
- محاسبه آنی مزایا بر اساس موجودی توکن
- دکمه‌های سریع برای استفاده از توکن‌ها

### 2. بخش‌های دیگر رابط کاربری

**صفحه خرید توکن:**
- بسته‌های مختلف خرید توکن
- محاسبه تخفیف برای خرید بیشتر
- روش‌های پرداخت متنوع

**صفحه انتقال توکن:**
- امکان انتقال توکن به کاربران دیگر (فقط برای توکن‌های خریداری شده)
- مشاهده تاریخچه انتقال‌ها
- تنظیمات امنیتی انتقال

**صفحه تنظیمات توکن:**
- تنظیم اعلان‌های مربوط به توکن
- مدیریت توکن‌های منقضی شده
- تنظیمات اولویت مصرف

## امنیت و مدیریت خطا

### 1. چالش‌های امنیتی

**تراکنش‌های همزمان:**
- استفاده از قفل‌های دیتابیس برای جلوگیری از race condition
- اجرای تراکنش‌ها در محدوده یک تراکنش دیتابیس
- بررسی مجدد موجودی قبل از تأیید هر تراکنش

**حفاظت از تراکنش‌ها:**
- ثبت لاگ کامل از تمام تراکنش‌ها
- تأیید هویت و اعتبارسنجی مجوز قبل از هر عملیات
- محدودیت تعداد تراکنش‌ها برای جلوگیری از سوء استفاده

**جلوگیری از خطاهای کاربری:**
- نمایش هشدار قبل از عملیات غیرقابل بازگشت
- تأیید دو مرحله‌ای برای تراکنش‌های مهم
- امکان لغو برخی تراکنش‌ها در بازه زمانی مشخص

### 2. سیاست‌های مدیریت خطا

**خطاهای تراکنش:**
- ثبت کامل خطاها در لاگ‌ها
- ارسال اعلان به تیم پشتیبانی برای خطاهای حیاتی
- ارائه پیام‌های خطای روشن و راهنما به کاربر

**بازیابی از خطا:**
- امکان بازیابی تراکنش‌های ناموفق
- مکانیزم خودکار تلاش مجدد برای تراکنش‌های مهم
- تهیه گزارش‌های دوره‌ای از خطاها برای تحلیل

## گزارش‌گیری و تحلیل

### 1. گزارش‌های مدیریتی

**گزارش توکن‌های ایجاد شده:**
- تعداد و مقدار توکن‌های ایجاد شده در بازه‌های زمانی مختلف
- توزیع توکن‌ها بر اساس نوع و منبع
- روند تولید توکن در طول زمان

**گزارش توکن‌های مصرف شده:**
- تعداد و مقدار توکن‌های مصرف شده
- محبوب‌ترین روش‌های مصرف توکن
- میانگین زمان بین تولید و مصرف

**گزارش توکن‌های منقضی شده:**
- تعداد و مقدار توکن‌های منقضی شده
- دلایل انقضا
- تحلیل رفتار کاربران با توکن‌های نزدیک به انقضا

### 2. تحلیل‌های پیشرفته

**تحلیل رفتار کاربران:**
- شناسایی الگوهای رفتاری در کسب و مصرف توکن
- بخش‌بندی کاربران بر اساس رفتار توکن
- پیش‌بینی رفتار آینده بر اساس داده‌های تاریخی

**تحلیل‌های تجاری:**
- محاسبه ROI سیستم توکن
- تحلیل تأثیر توکن بر وفاداری مشتریان
- بهینه‌سازی قوانین توکن بر اساس داده‌ها

## توسعه آینده سیستم توکن

### 1. ویژگی‌های پیشنهادی

**توکن‌های اجتماعی:**
- امکان ایجاد کمپین‌های اهدای توکن برای مقاصد خیریه
- اشتراک‌گذاری توکن با دوستان و خانواده
- رویدادهای اجتماعی مبتنی بر توکن

**هوش مصنوعی و شخصی‌سازی:**
- پیشنهادهای شخصی‌سازی شده برای کسب و مصرف توکن
- پیش‌بینی زمان بهینه برای استفاده از توکن‌ها
- تنظیم خودکار قوانین بر اساس رفتار کاربر

**بازی‌سازی (Gamification):**
- چالش‌های روزانه و هفتگی برای کسب توکن
- سیستم رتبه‌بندی و دستاوردها
- رقابت‌های دوستانه برای کسب توکن

### 2. مقیاس‌پذیری

**بهینه‌سازی عملکرد:**
- کش‌گذاری داده‌های پرکاربرد
- پارتیشن‌بندی جداول برای حجم بالای داده
- پردازش غیرهمزمان تراکنش‌ها

**معماری توزیع شده:**
- تبدیل سیستم توکن به یک میکروسرویس مستقل
- استفاده از صف‌های پیام‌رسان برای مقیاس‌پذیری
- پشتیبانی از تعداد بالای کاربر همزمان

## نتیجه‌گیری

سیستم توکن مانیبل (MoneyBell) یک مؤلفه حیاتی در پروژه دستیار هوشمند یک دو سه است که با ایجاد یک اکوسیستم ارزش دیجیتال، انگیزه و وفاداری کاربران را افزایش می‌دهد. این سیستم با طراحی انعطاف‌پذیر و مقیاس‌پذیر خود، امکان تطبیق با نیازهای متغیر کسب‌وکار را فراهم می‌کند.

با پیاده‌سازی صحیح این سیستم، کاربران قادر خواهند بود توکن‌ها را کسب کرده، ذخیره کنند و برای دریافت خدمات و مزایای مختلف استفاده کنند. همچنین، سیستم امکان تحلیل رفتار کاربران و بهینه‌سازی استراتژی‌های کسب‌وکار را فراهم می‌کند.

</div>