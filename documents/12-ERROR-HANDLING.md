# 12-ERROR-HANDLING.md (ai123/documents/12-ERROR-HANDLING.md)

# راهنمای مدیریت خطا

## اصول مدیریت خطا
مدیریت خطای مناسب در پروژه SmartAi123 نقش مهمی در تجربه کاربری، قابلیت نگهداری و امنیت سیستم دارد. این سند اصول و بهترین شیوه‌های مدیریت خطا را شرح می‌دهد.

## ساختار خطاها

### طبقه‌بندی خطاها
- **خطاهای کاربری**: اشتباهات ورودی، خطاهای اعتبارسنجی، دسترسی‌های غیرمجاز
- **خطاهای سیستمی**: مشکلات پایگاه داده، خطاهای شبکه، مشکلات سرور
- **خطاهای تجاری**: نقض قوانین کسب‌وکار، محدودیت‌های سیستم توکن
- **خطاهای امنیتی**: تلاش‌های نفوذ، درخواست‌های مشکوک

### کد خطاها
هر خطا باید دارای یک کد منحصر به فرد باشد:
- فرمت: `EXXX-YYY` (X: نوع خطا، Y: کد خاص)
- مثال: `E001-403` برای خطای دسترسی غیرمجاز

## مدیریت خطا در فرانت‌اند

### اصول پایه
- استفاده از ساختار try/catch برای مدیریت خطاهای غیرمنتظره
- اعتبارسنجی ورودی‌ها قبل از ارسال به سرور
- استفاده از کتابخانه‌های فرم مانند Formik یا React Hook Form برای اعتبارسنجی

### نمایش خطا به کاربر
- پیام‌های خطای واضح و کاربرپسند
- استفاده از کامپوننت‌های اختصاصی برای نمایش خطا (Toast, Alert, Banner)
- عدم نمایش جزئیات فنی خطا به کاربر نهایی

### بازیابی از خطا
- تلاش مجدد خودکار برای خطاهای شبکه
- حفظ داده‌های فرم در صورت خطا
- بازگرداندن کاربر به حالت پایدار

## مدیریت خطا در بک‌اند

### ساختار استاندارد پاسخ خطا
```json
{
  "status": "error",
  "code": "E001-403",
  "message": "دسترسی به این بخش مجاز نیست",
  "details": { ... },
  "timestamp": "2023-05-15T14:30:00Z"
}
```

### میان‌افزار مدیریت خطا
- استفاده از میان‌افزار مرکزی برای مدیریت تمام خطاها
- جلوگیری از سرریز خطاهای پردازش نشده
- ثبت مناسب خطاها برای تحلیل بعدی

### لاگ‌گذاری خطاها
- ثبت کامل جزئیات خطا در سیستم لاگ
- استفاده از سطوح مختلف اهمیت (Error, Warning, Info)
- درج اطلاعات بافتی بدون داده‌های حساس

## خطاهای خاص

### مدیریت خطاهای تبدیل اعداد فارسی/انگلیسی
- تشخیص و تبدیل خودکار اعداد فارسی به انگلیسی
- ارائه پیام خطای مناسب در صورت شکست تبدیل
- اعتبارسنجی داده‌های عددی پس از تبدیل

### خطاهای مرتبط با توکن MoneyBell
- کدهای خطای مخصوص برای مشکلات تراکنش
- مکانیسم بازیابی برای تراکنش‌های ناتمام
- اطلاع‌رسانی به کاربر درباره وضعیت تراکنش

## تست مدیریت خطا
- تست واحد برای توابع مدیریت خطا
- تست یکپارچگی برای بررسی جریان‌های خطا
- شبیه‌سازی سناریوهای خطا برای ارزیابی سیستم

## مستندسازی
- مستندسازی تمام کدهای خطا و معانی آن‌ها
- راهنمای عیب‌یابی برای خطاهای شایع
- تهیه الگوهای مدیریت خطا برای توسعه‌دهندگان